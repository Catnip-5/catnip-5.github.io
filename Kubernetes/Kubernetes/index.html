<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/icon_32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/icon_32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/icon_32.png">
  <link rel="mask-icon" href="/images/icons/icon_32.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"catnip-5.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="K8S 介绍K8S 概述 K8S 是谷歌在2014年开业的容器化集群管理系统。 使用 K8S 进行容器化应用部署。 使用 K8S 利于应用扩展。 K8S 目标实施让部署容器化应用更加简洁和高效。">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes">
<meta property="og:url" content="https://catnip-5.github.io/Kubernetes/Kubernetes/index.html">
<meta property="og:site_name" content="Catnip">
<meta property="og:description" content="K8S 介绍K8S 概述 K8S 是谷歌在2014年开业的容器化集群管理系统。 使用 K8S 进行容器化应用部署。 使用 K8S 利于应用扩展。 K8S 目标实施让部署容器化应用更加简洁和高效。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-04-27T06:43:30.000Z">
<meta property="article:modified_time" content="2025-05-08T02:29:51.275Z">
<meta property="article:author" content="Catnip">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://catnip-5.github.io/Kubernetes/Kubernetes/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Kubernetes | Catnip</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Catnip" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Catnip</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">100</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">37</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>
<div id="hitokoto" style="text-align: center;padding: 5px 0px 20px 0px;">&nbsp;</div>


<script>
  fetch('https://v1.hitokoto.cn')
    .then(function (res){
      return res.json();
    })
    .then(function (data) {
      var hitokoto = document.getElementById('hitokoto');
      hitokoto.innerText = "" + data.hitokoto + "  来自于 " + data.from;
    })
    .catch(function (err) {
      console.error(err);
    });
</script>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://catnip-5.github.io/Kubernetes/Kubernetes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Catnip">
      <meta itemprop="description" content="度过大难, 将有大成, 继续努力, 终成大器.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Catnip">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kubernetes
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-27 14:43:30" itemprop="dateCreated datePublished" datetime="2025-04-27T14:43:30+08:00">2025-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-05-08 10:29:51" itemprop="dateModified" datetime="2025-05-08T10:29:51+08:00">2025-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="K8S-介绍"><a href="#K8S-介绍" class="headerlink" title="K8S 介绍"></a>K8S 介绍</h2><h3 id="K8S-概述"><a href="#K8S-概述" class="headerlink" title="K8S 概述"></a>K8S 概述</h3><ul>
<li>K8S 是谷歌在2014年开业的容器化集群管理系统。</li>
<li>使用 K8S 进行容器化应用部署。</li>
<li>使用 K8S 利于应用扩展。</li>
<li>K8S 目标实施让部署容器化应用更加简洁和高效。</li>
</ul>
<span id="more"></span>

<h3 id="K8S特性"><a href="#K8S特性" class="headerlink" title="K8S特性"></a>K8S特性</h3><ul>
<li><strong>自动装箱：</strong> 根据资源需求自动部署容器。</li>
<li><strong>自我修复：</strong> 容器失败时自动重启；Node 故障时重新部署和调度容器；监控失败时暂停服务，直至容器恢复。</li>
<li><strong>水平扩展：</strong> 通过命令、UI 或 CPU 使用率自动扩展或缩减容器规模。</li>
<li><strong>服务发现：</strong> 内置服务发现和负载均衡，无需额外机制。</li>
<li><strong>滚动更新：</strong> 支持一次性或批量更新应用。</li>
<li><strong>版本回退：</strong> 支持快速回退至历史版本。</li>
<li><strong>密钥和配置管理：</strong> 无需重建镜像即可更新密钥和配置。</li>
<li><strong>存储编排：</strong> 自动挂载存储系统，支持本地、网络存储（如 NFS、Gluster、Ceph）及云存储，适合有状态应用。</li>
<li><strong>批处理：</strong> 支持一次性任务和定时任务，满足批量数据处理需求。</li>
</ul>
<h3 id="K8S-架构组件"><a href="#K8S-架构组件" class="headerlink" title="K8S 架构组件"></a>K8S 架构组件</h3><ul>
<li><strong>Master Node 组件</strong><ul>
<li><code>API Server</code> 集群统一入口，处理 RESTful 请求，数据存储至 etcd。</li>
<li><code>Controller Manager</code> 管理集群后台任务，每种资源对应一个控制器。</li>
<li><code>Scheduler</code> 负责节点调度，根据策略将应用部署到合适的节点。</li>
<li><code>etcd</code> 存储系统，用于保存集群相关的数据。</li>
</ul>
</li>
<li><strong>Worker Node 组件</strong><ul>
<li><code>Kubelet</code> 节点代理，接收主节点指令，管理本地容器。</li>
<li><code>Kube-Proxy</code> 提供网络代理和负载均衡功能。</li>
</ul>
</li>
</ul>
<h3 id="K8S-核心概念"><a href="#K8S-核心概念" class="headerlink" title="K8S 核心概念"></a>K8S 核心概念</h3><ul>
<li><code>Pod</code> 最小部署单元；一组容器的集合；共享网络；生命周期是短暂的。</li>
<li><code>Controller</code> 确保预期的 Pod 副本数量；无状态应用部署；有状态应用部署；确保所有的 Node 运行同一个 Pod；一次性任务和定时任务。</li>
<li><code>Service</code> 定义一组 Pod 的访问规则。</li>
</ul>
<h2 id="K8S-集群搭建"><a href="#K8S-集群搭建" class="headerlink" title="K8S 集群搭建"></a>K8S 集群搭建</h2><h3 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h3><ul>
<li>操作系统 CentOS7.x</li>
<li>硬件要求：2GB 或更多 RAM，2个CPU 或更多 CPU，硬盘 30GB 或更多</li>
<li>集群中所有机器之间网络互通</li>
<li>可以访问外网，需要拉取镜像</li>
<li>禁止 swap 分区</li>
</ul>
<h3 id="系统初始化"><a href="#系统初始化" class="headerlink" title="系统初始化"></a>系统初始化</h3><ol>
<li><strong>关闭防火墙：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop firewalld</span><br><span class="line">$ systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure></li>
<li><strong>关闭 selinux：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">&#x27;s/enforcing/disabled/&#x27;</span> /etc/selinux/config <span class="comment"># 永久</span></span><br><span class="line">$ setenforce 0 <span class="comment"># 临时</span></span><br></pre></td></tr></table></figure></li>
<li><strong>关闭 swap：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ swapoff -a      <span class="comment"># 临时</span></span><br><span class="line">$ sed -ri <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab  <span class="comment"># 永久</span></span><br></pre></td></tr></table></figure></li>
<li><strong>主机名：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hostnamectl set-hostname &lt;hostname&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>在 master 添加 hosts：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.1.1 k8s-master</span></span><br><span class="line"><span class="string">192.168.1.2 k8s-node1</span></span><br><span class="line"><span class="string">192.168.1.3 k8s-node2</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></li>
<li><strong>将桥接的 IPv4 流量传递到 iptables 的链：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">$ sysctl --system <span class="comment"># 生效</span></span><br></pre></td></tr></table></figure></li>
<li><strong>时间同步：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install ntpdate -y</span><br><span class="line">$ ntpdate time.windows.com</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="方式一：kubeadm"><a href="#方式一：kubeadm" class="headerlink" title="方式一：kubeadm"></a>方式一：kubeadm</h3><h4 id="安装-Docker-kubeadm-kubelet"><a href="#安装-Docker-kubeadm-kubelet" class="headerlink" title="安装 Docker&#x2F;kubeadm&#x2F;kubelet"></a>安装 Docker&#x2F;kubeadm&#x2F;kubelet</h4><ol>
<li><strong>安装 Docker：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O</span><br><span class="line">/etc/yum.repos.d/docker-ce.repo</span><br><span class="line">$ yum -y install docker-ce-18.06.1.ce-3.el7</span><br><span class="line">$ systemctl <span class="built_in">enable</span> docker &amp;&amp; systemctl start docker</span><br><span class="line">$ docker --version</span><br></pre></td></tr></table></figure></li>
<li><strong>设置 Docker 阿里云镜像：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;: [&quot;https://b9pmyelo.mirror.aliyuncs.com&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">$ systemctl restart docker</span><br></pre></td></tr></table></figure></li>
<li><strong>添加 Yum 阿里云软件源：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">repo_gpgcheck=0</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span></span><br><span class="line"><span class="string">https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></li>
<li><strong>安装 kubeadm，kubelet 和 kubectl：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0</span><br><span class="line">$ systemctl <span class="built_in">enable</span> kubelet</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="部署-Kubernetes-Master"><a href="#部署-Kubernetes-Master" class="headerlink" title="部署 Kubernetes Master"></a>部署 Kubernetes Master</h4><ol>
<li><strong>kubeadm 初始化（Master中执行）：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init \</span><br><span class="line">--apiserver-advertise-address=192.168.1.1 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version v1.18.0 \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure></li>
<li><strong>使用 kubectl 工具（Master中执行）：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">$ sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">$ sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure></li>
<li><strong>安装 CNI 网络插件（Master中执行）：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply –f</span><br><span class="line">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kubeflannel.yml</span><br><span class="line">$ kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure></li>
<li><strong>加入 Node（所有Node中执行）：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init 输出的 kubeadm <span class="built_in">join</span> 命令：</span><br><span class="line">  kubeadm <span class="built_in">join</span> 192.168.1.1:6443 --token esce21.q6hetwm8si29qxwn \</span><br><span class="line">--discovery-token-ca-cert-hash</span><br><span class="line">sha256:00603a05805807501d7181c3d60b478788408cfe6cedefedb1f97569708be9c5</span><br><span class="line">$ kubectl get nodes</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="测试-Kubernetes"><a href="#测试-Kubernetes" class="headerlink" title="测试 Kubernetes"></a>测试 Kubernetes</h4><ol>
<li><strong>部署测试 Nginx：</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment nginx --image=nginx</span><br><span class="line">$ kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort</span><br><span class="line">$ kubectl get pod,svc</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="方式二：二进制包"><a href="#方式二：二进制包" class="headerlink" title="方式二：二进制包"></a>方式二：二进制包</h3><ul>
<li>待补充…</li>
</ul>
<h3 id="方式三：高可用集群"><a href="#方式三：高可用集群" class="headerlink" title="方式三：高可用集群"></a>方式三：高可用集群</h3><ul>
<li>待补充…</li>
</ul>
<h2 id="K8S-Kubectl命令"><a href="#K8S-Kubectl命令" class="headerlink" title="K8S Kubectl命令"></a>K8S Kubectl命令</h2><ul>
<li><strong>kubectl 语法</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl [<span class="built_in">command</span>] [TYPE] [NAME] [flags]</span><br><span class="line"></span><br><span class="line">[<span class="built_in">command</span>]：指定要对资源执行的操作，例如 create、get、describe 和delete</span><br><span class="line">[TYPE]：指定资源类型</span><br><span class="line">[NAME]：指定资源的名称，如果省略则会显示所有的资源</span><br><span class="line">[flags]：指定可选的参数</span><br></pre></td></tr></table></figure></li>
<li><strong>kubectl 命令</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础命令</span></span><br><span class="line">$ kubectl create：通过文件名（YAML/JSON）或标准输入创建资源</span><br><span class="line">$ kubectl expose：将资源（如 Pod、Deployment）公开为 Service，创建网络访问入口</span><br><span class="line">$ kubectl run：快速运行单个 Pod，常用于测试</span><br><span class="line">$ kubectl <span class="built_in">set</span>：修改资源属性，如镜像或资源限制</span><br><span class="line">$ kubectl get：显示一个或多个资源</span><br><span class="line">$ kubectl explain：查看资源字段文档，适合编写 YAML</span><br><span class="line">$ kubectl edit：直接编辑集群中资源</span><br><span class="line">$ kubectl delete：删除资源，支持多种方式</span><br><span class="line"></span><br><span class="line"><span class="comment">## 部署命令</span></span><br><span class="line">$ kubectl rollout：管理 Deployment 的发布过程</span><br><span class="line">$ kubectl rolling-update：对 ReplicationController 滚动更新</span><br><span class="line">$ kubectl scale：调整 Deployment、ReplicaSet 或 Job 的 Pod 副本数量</span><br><span class="line">$ kubectl autoscale：创建 HPA 实现自动扩缩容</span><br><span class="line"></span><br><span class="line"><span class="comment">## 集群管理命令</span></span><br><span class="line">$ kubectl certificate：管理 CSR（证书签名请求）</span><br><span class="line">$ kubectl cluster-info：显示集群控制平面信息</span><br><span class="line">$ kubectl top：查看节点或 Pod 的资源（CPU/Memory/Storage）使用</span><br><span class="line">$ kubectl cordon：标记节点为不可调度，防止新 Pod 调度到该节点</span><br><span class="line">$ kubectl uncordon：取消节点的不可调度状态</span><br><span class="line">$ kubectl drain：驱逐节点上的 Pod，准备维护</span><br><span class="line">$ kubectl taint：管理节点污点，控制 Pod 调度</span><br><span class="line"></span><br><span class="line"><span class="comment">## 故障诊断和调试命令</span></span><br><span class="line">$ kubectl describe：显示资源（如 Pod、Node、Service）的详细信息，包括事件</span><br><span class="line">$ kubectl logs：获取 Pod 中容器的日志</span><br><span class="line">$ kubectl attach：附加到运行中的容器，类似 docker attach</span><br><span class="line">$ kubectl <span class="built_in">exec</span>：在容器中执行命令，类似 docker <span class="built_in">exec</span></span><br><span class="line">$ kubectl port-forward：将本地端口转发到 Pod 的端口，便于调试</span><br><span class="line">$ kubectl proxy：创建到 Kubernetes API Server 的代理，便于直接访问 API</span><br><span class="line">$ kubectl <span class="built_in">cp</span>：在本地和容器之间复制文件</span><br><span class="line">$ kubectl auth：检查用户或服务账户的权限</span><br><span class="line"></span><br><span class="line"><span class="comment">## 高级命令</span></span><br><span class="line">$ kubectl apply：通过声明式配置文件（YAML/JSON）创建或更新资源</span><br><span class="line">$ kubectl patch：对资源进行部分更新（如修改字段）</span><br><span class="line">$ kubectl replace：替换现有资源（需要完整配置文件）</span><br><span class="line">$ kubectl convert：将配置文件在不同 API 版本间转换</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置命令</span></span><br><span class="line">$ kubectl label：添加或更新资源的标签</span><br><span class="line">$ kubectl annotate：添加或更新资源的注释</span><br><span class="line">$ kubectl completion：生成 kubectl 命令自动补全脚本</span><br><span class="line"></span><br><span class="line"><span class="comment">## 其他命令</span></span><br><span class="line">$ kubectl api-versions：列出支持的 API 版本</span><br><span class="line">$ kubectl config：管理 kubeconfig 文件（如切换上下文或集群）</span><br><span class="line">$ kubectl <span class="built_in">help</span>：查看命令帮助</span><br><span class="line">$ kubectl plugin：运行插件</span><br><span class="line">$ kubectl version：查看版本信息</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="K8S-YAML文件"><a href="#K8S-YAML文件" class="headerlink" title="K8S YAML文件"></a>K8S YAML文件</h2><h3 id="YAML-文件快速生成"><a href="#YAML-文件快速生成" class="headerlink" title="YAML 文件快速生成"></a>YAML 文件快速生成</h3><ul>
<li>使用<code>kubectl create</code>命令生成 yaml 文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment &lt;name&gt; --image=&lt;image&gt; -o yaml --dry-run=client &gt; my.yaml</span><br></pre></td></tr></table></figure></li>
<li>使用<code>kubectl get</code>命令导出 yaml 文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get deployment &lt;name&gt; -o=yaml --<span class="built_in">export</span> &gt; my.yaml</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="YAML-文件必须属性"><a href="#YAML-文件必须属性" class="headerlink" title="YAML 文件必须属性"></a>YAML 文件必须属性</h3><ul>
<li><strong>Pod</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>              <span class="comment"># API版本（可用kubectl api-versions命令查询）</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                   <span class="comment"># 指定资源类型（可用kubectl api-resources查询）</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>              <span class="comment"># 元数据对象的名字</span></span><br><span class="line"><span class="attr">spec:</span>                       <span class="comment"># 定义资源的核心配置</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>             <span class="comment"># 容器名称</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span>     <span class="comment"># 容器镜像</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Deployment</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>        </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>             </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">my-test</span>            <span class="comment"># 整个资源对象 标签</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span>               <span class="comment"># 副本数，必需（默认值 1）</span></span><br><span class="line">  <span class="attr">selector:</span>                 <span class="comment"># 选择器，用于匹配 Pod 标签，必需</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span>           <span class="comment"># 与 spec.template.metadata.labels 匹配</span></span><br><span class="line">  <span class="attr">template:</span>                 <span class="comment"># Pod 模板，必需</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span>         <span class="comment"># Pod 标签，必需（生成 Pod 时自动带上这个标签）</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span>           <span class="comment"># 容器列表，必需</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br></pre></td></tr></table></figure></li>
<li><strong>Service</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>         </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span>                 <span class="comment"># 选择器，用于选择后端 Pod，必需（除非是 ExternalName 类型）</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">  <span class="attr">ports:</span>                    <span class="comment"># 端口列表，必需</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></li>
<li><strong>ConfigMap</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-config</span></span><br><span class="line"><span class="attr">data:</span>                       <span class="comment"># data 或 binaryData 至少需要一个，用于存储配置数据，必需</span></span><br><span class="line">  <span class="attr">key1:</span> <span class="string">value1</span>              </span><br></pre></td></tr></table></figure></li>
<li><strong>PersistentVolumeClaim (PVC)</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span>              <span class="comment"># 访问模式，必需</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>         <span class="comment"># 定义存储的访问模式</span></span><br><span class="line">  <span class="attr">resources:</span>                <span class="comment"># 资源请求，必需</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span>          <span class="comment"># 指定请求的存储容量</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="K8S-Pod"><a href="#K8S-Pod" class="headerlink" title="K8S Pod"></a>K8S Pod</h2><h3 id="Pod-概念"><a href="#Pod-概念" class="headerlink" title="Pod 概念"></a>Pod 概念</h3><ul>
<li>最小部署的单元</li>
<li>一组容器的集合</li>
<li>共享网络</li>
<li>生命周期是短暂的</li>
</ul>
<h3 id="Pod-存在的意义"><a href="#Pod-存在的意义" class="headerlink" title="Pod 存在的意义"></a>Pod 存在的意义</h3><ul>
<li><strong>容器运行模型：</strong> Docker 创建容器，每个容器运行一个进程或应用程序。</li>
<li><strong>多容器设计：</strong> Pod 包含多个容器，每个容器运行一个应用程序，支持多进程协作。</li>
<li><strong>亲密性应用：</strong> Pod 内的容器可直接交互、共享网络，适合频繁调用或紧密协作的应用场景。</li>
</ul>
<h3 id="Pod-实现机制"><a href="#Pod-实现机制" class="headerlink" title="Pod 实现机制"></a>Pod 实现机制</h3><ul>
<li><strong>共享网络：</strong> 通过 <code>Pause</code> 容器创建共享网络命名空间，所有业务容器加入其中，实现网络共享。</li>
<li><strong>共享存储：</strong> 使用 <code>Volume</code> 数据卷进行持久化存储，供 Pod 容器共享。</li>
</ul>
<h3 id="Pod-镜像拉取策略"><a href="#Pod-镜像拉取策略" class="headerlink" title="Pod 镜像拉取策略"></a>Pod 镜像拉取策略</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>         </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>          </span><br><span class="line"><span class="attr">spec:</span>                   </span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>    </span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span> </span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>spec.containers[].imagePullPolicy</code> 镜像拉取策略<ul>
<li><code>IfNotPresent</code> 默认值，镜像在宿主机上不存在时才拉取。</li>
<li><code>Always</code> 每次创建 Pod 都会重新拉取一次镜像。</li>
<li><code>Never</code> Pod 永远不会主动拉取这个镜像。</li>
</ul>
</li>
</ul>
<h3 id="Pod-资源限制"><a href="#Pod-资源限制" class="headerlink" title="Pod 资源限制"></a>Pod 资源限制</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span>   </span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:latest</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span>             <span class="comment"># 指定容器所需的最小资源</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;64Mi&quot;</span>      <span class="comment"># 请求 64M 内存  </span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span>         <span class="comment"># 请求 250 毫核 CPU（1/4 个 CPU 核心）</span></span><br><span class="line">      <span class="attr">limits:</span>               <span class="comment"># 指定容器可用的最大资源</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;128Mi&quot;</span>     <span class="comment"># 最多 128M 内存</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span>         <span class="comment"># 最多 500 毫核 CPU（1/2 个 CPU 核心）</span></span><br></pre></td></tr></table></figure>

<h3 id="Pod-重启策略"><a href="#Pod-重启策略" class="headerlink" title="Pod 重启策略"></a>Pod 重启策略</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>         </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>          </span><br><span class="line"><span class="attr">spec:</span>                   </span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>    </span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span> </span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>spec.restartPolicy</code> 重启策略<ul>
<li><code>Always</code> 默认值，当容器终止退出后，总是重启容器。</li>
<li><code>OnFailure</code> 当容器异常退出时（退出状态码非0），才重启容器。</li>
<li><code>Never</code> 当容器终止退出，从不重启容器。</li>
</ul>
</li>
</ul>
<h3 id="Pod-健康检查"><a href="#Pod-健康检查" class="headerlink" title="Pod 健康检查"></a>Pod 健康检查</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                        </span><br><span class="line"><span class="attr">metadata:</span>                        </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>        </span><br><span class="line"><span class="attr">spec:</span>                             </span><br><span class="line">  <span class="attr">containers:</span>                     </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>          </span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span>           </span><br><span class="line">    <span class="attr">livenessProbe:</span>                <span class="comment"># 定义存活探针，检查容器是否存活</span></span><br><span class="line">      <span class="attr">httpGet:</span>                    <span class="comment"># 使用 HTTP GET 请求进行探针检查</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span>                   <span class="comment"># 检查的路径，Nginx 默认首页</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span>                  <span class="comment"># 检查的端口，Nginx 默认监听 80</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">15</span>     <span class="comment"># 容器启动后延迟 15 秒开始首次探针</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">10</span>           <span class="comment"># 每 10 秒执行一次探针检查</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>spec.containers[].*Probe</code> 健康检查策略<ul>
<li><code>livenessProbe</code> 存活探针，检查容器是否存活，失败将杀死容器，然后根据 Pod 的重启策略来操作。</li>
<li><code>readinessProbe</code> 就绪探针，检查容器是否准备好接收流量，失败 K8S 会把 Pod 从 service endpoints 中剔除。</li>
</ul>
</li>
<li><code>spec.containers[].*Probe。*</code> 健康检查请求方式<ul>
<li><code>httpGet</code> 发送 HTTP 请求，返回 200-400 范围状态码为成功。</li>
<li><code>exec</code> 执行 Shell 命令返回状态码是 0 为成功。</li>
<li><code>tcpSocket</code> 发送 TCP Socket 建立成功。</li>
</ul>
</li>
</ul>
<h3 id="Pod-创建流程"><a href="#Pod-创建流程" class="headerlink" title="Pod 创建流程"></a>Pod 创建流程</h3><ul>
<li><p><strong>解释：</strong></p>
<ul>
<li><code>API Server</code> 用户和集群的桥梁，存取 etcd。</li>
<li><code>etcd</code> 保存所有 Pod 和集群状态。</li>
<li><code>Scheduler</code> 决定 Pod 跑在哪个节点。</li>
<li><code>Kubelet</code> 节点上的“管家”，创建和管理 Pod。</li>
<li><code>Docker</code> 实际跑容器的工具。</li>
</ul>
</li>
<li><p><strong>流程：</strong></p>
<ol>
<li><strong>用户提交 Pod 定义：</strong><ul>
<li>用户通过 <code>kubectl apply -f xxx.yaml</code> 或其他方式提交 Pod 的 YAML 文件到 K8S 集群</li>
<li>请求发送到 API Server</li>
</ul>
</li>
<li><strong>API Server 处理请求：</strong><ul>
<li>验证 YAML 文件的合法性（如语法、权限）</li>
<li>存储 Pod 定义到 etcd，返回确认（Pod 对象创建，未运行）</li>
</ul>
</li>
<li><strong>etcd 存储 Pod 数据：</strong><ul>
<li>存储 Pod 的定义（包括名称、镜像、资源请求等）</li>
</ul>
</li>
<li><strong>Scheduler 调度 Pod：</strong><ul>
<li>监控 API Server（通过 etcd）中的未调度 Pod（<code>spec.nodeName</code> 为空）。</li>
<li>根据节点资源（CPU、内存）、约束条件等选择合适的节点，更新 Pod 定义，设置 <code>spec.nodeName</code>（绑定 Pod 到节点）。</li>
<li>将更新后的 Pod 数据写回 etcd（通过 API Server）。</li>
</ul>
</li>
<li><strong>Kubelet 检测并创建 Pod：</strong><ul>
<li>监控 API Server，获取分配到本节点的 Pod（通过 <code>spec.nodeName</code> 匹配）。</li>
<li>调用容器运行时（如 Docker），根据 Pod 的 spec 创建容器，配置网络（CNI）和存储（Volume）。</li>
<li>启动容器并监控其状态（如健康检查），定期向 API Server 更新 Pod 状态（如 Running、Failed）。</li>
</ul>
</li>
<li><strong>Docker（或其他容器运行时）执行容器：</strong><ul>
<li>接收 Kubelet 的指令，拉取容器镜像，创建并启动容器。</li>
<li>配置网络和存储，报告状态给 Kubelet。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="Pod-调度限制"><a href="#Pod-调度限制" class="headerlink" title="Pod 调度限制"></a>Pod 调度限制</h3><ol>
<li><strong>resources 资源限制：</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span>   </span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:latest</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span>             <span class="comment"># 指定容器所需的最小资源</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;64Mi&quot;</span>      <span class="comment"># 请求 64M 内存  </span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span>         <span class="comment"># 请求 250 毫核 CPU（1/4 个 CPU 核心）</span></span><br><span class="line">      <span class="attr">limits:</span>               <span class="comment"># 指定容器可用的最大资源</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;128Mi&quot;</span>     <span class="comment"># 最多 128M 内存</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span>         <span class="comment"># 最多 500 毫核 CPU（1/2 个 CPU 核心）</span></span><br></pre></td></tr></table></figure></li>
<li><strong>nodeSelector 标签限制：</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                         </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                               </span><br><span class="line"><span class="attr">metadata:</span>                              </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>                          </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">containers:</span>                          </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                       </span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span>              </span><br><span class="line">  <span class="attr">nodeSelector:</span>             <span class="comment"># 节点选择器</span></span><br><span class="line">    <span class="attr">k1:</span> <span class="string">v1</span>                  <span class="comment"># 节点标签键值对，要求节点具有 k1=v1</span></span><br></pre></td></tr></table></figure></li>
<li><strong>nodeAffinity 亲和性限制：</strong></li>
</ol>
<ul>
<li><code>requiredDuringSchedulingIgnoredDuringExecution</code> 硬亲和性，约束条件必须满足。</li>
<li><code>preferredDuringSchedulingIgnoredDuringExecution</code> 软亲和性，约束条件尝试满足，不保证。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                           </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                               </span><br><span class="line"><span class="attr">metadata:</span>                              </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>                    </span><br><span class="line">  <span class="attr">labels:</span>                               </span><br><span class="line">    <span class="attr">app:</span> <span class="string">example</span>                        <span class="comment"># 标签键值对，app=example</span></span><br><span class="line"><span class="attr">spec:</span>                                </span><br><span class="line">  <span class="attr">containers:</span>                          </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                       </span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span>                </span><br><span class="line">  <span class="attr">affinity:</span>                             <span class="comment"># 亲和性规则</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span>                       <span class="comment"># 节点亲和性</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span>  <span class="comment"># 调度时必须满足的规则</span></span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span>              <span class="comment"># 节点选择条件</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span>             <span class="comment"># 匹配表达式</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">active</span>                 <span class="comment"># 节点标签的键</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span>                <span class="comment"># 操作符，In 表示包含</span></span><br><span class="line">            <span class="attr">values:</span>                     <span class="comment"># 匹配的值，可多个</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">dev</span>                      </span><br><span class="line">            <span class="bullet">-</span> <span class="string">test</span>                      </span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span>  <span class="comment"># 调度时优先考虑的规则</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">80</span>                      <span class="comment"># 优先级权重（1-100）</span></span><br><span class="line">        <span class="attr">preference:</span>                     <span class="comment"># 优先匹配条件</span></span><br><span class="line">          <span class="attr">matchExpressions:</span>             </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">group</span>                  </span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span>                </span><br><span class="line">            <span class="attr">values:</span>                     </span><br><span class="line">            <span class="bullet">-</span> <span class="string">other</span>                    </span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><strong>Taint 污点和污点容忍限制：</strong><ul>
<li><strong>使用场景：</strong><ul>
<li>专用节点。</li>
<li>配置特定硬件节点。</li>
<li>基于Taint驱逐。</li>
</ul>
</li>
<li><strong>污点策略：</strong><ul>
<li><code>NoSchedule</code> 一定不被调度。</li>
<li><code>PreferNoSchedule</code> 尽量不被调度。</li>
<li><code>NoExecute</code> 不会调度，并且还会驱逐 Node 已有 Pod。</li>
</ul>
</li>
<li><strong>具体使用：</strong> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看节点污点</span></span><br><span class="line">kubectl describe node &lt;node-name&gt; | grep Taint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加节点污点</span></span><br><span class="line">kubectl taint node &lt;node-name&gt; key=value:污点策略</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除节点污点</span></span><br><span class="line">kubectl taint node &lt;node-name&gt; key:污点策略-</span><br></pre></td></tr></table></figure></li>
<li><strong>污点容忍：</strong> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">  <span class="attr">tolerations:</span>                <span class="comment"># 污点容忍</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;k1&quot;</span>               <span class="comment"># 污点的键</span></span><br><span class="line">      <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span>       <span class="comment"># 匹配操作符，Equal 表示相等匹配</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;v1&quot;</span>             <span class="comment"># 污点的值</span></span><br><span class="line">      <span class="attr">effect:</span> <span class="string">&quot;NoSchedule&quot;</span>    <span class="comment"># 污点策略</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="K8S-Controller"><a href="#K8S-Controller" class="headerlink" title="K8S Controller"></a>K8S Controller</h2><h3 id="Controller-概念"><a href="#Controller-概念" class="headerlink" title="Controller 概念"></a>Controller 概念</h3><ul>
<li>在集群上管理和运行容器的对象。</li>
</ul>
<h3 id="Controller-作用"><a href="#Controller-作用" class="headerlink" title="Controller 作用"></a>Controller 作用</h3><ul>
<li>监控 Pod 状态，自动调整（如重启、扩容）。</li>
<li>提供高级功能，如副本管理、滚动更新等。</li>
</ul>
<h3 id="Controller-常用类型"><a href="#Controller-常用类型" class="headerlink" title="Controller 常用类型"></a>Controller 常用类型</h3><ul>
<li><code>ReplicaSet</code> 确保指定数量的 Pod 副本运行。</li>
<li><code>Deployment</code> 管理无状态应用（<code>ReplicaSet</code>），提供滚动更新、回滚等功能。</li>
<li><code>StatefulSet</code> 管理有状态应用，维护 Pod 顺序和唯一性。</li>
<li><code>DaemonSet</code> 守护进程，确保每个节点运行一个 Pod 副本。</li>
<li><code>Job/CronJob</code> 运行一次性或定时任务。</li>
</ul>
<h3 id="无状态与有状态的区别"><a href="#无状态与有状态的区别" class="headerlink" title="无状态与有状态的区别"></a>无状态与有状态的区别</h3><table>
<thead>
<tr>
<th></th>
<th>无状态应用</th>
<th>有状态应用</th>
</tr>
</thead>
<tbody><tr>
<td>状态保存</td>
<td>不保存状态，数据在外</td>
<td>保存数据，有本地数据</td>
</tr>
<tr>
<td>实例等同性</td>
<td>实例相同，可随意替换</td>
<td>实例不同，有唯一标识或数据</td>
</tr>
<tr>
<td>扩容难度</td>
<td>简单，直接增&#x2F;删实例</td>
<td>复杂，需考虑数据同步和启动顺序</td>
</tr>
<tr>
<td>Kubernetes控制器</td>
<td>Deployment、ReplicaSet</td>
<td>StatefulSet</td>
</tr>
<tr>
<td>应用场景</td>
<td>Web服务、API服务</td>
<td>数据库、消息队列</td>
</tr>
</tbody></table>
<h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><ol>
<li><strong>创建 deployment，生成 yaml 文件部署：</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成 yaml 文件</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">create</span> <span class="string">deployment</span> <span class="string">web-deploy</span> <span class="string">--image=nginx</span> <span class="string">--dry-run=client</span> <span class="string">-o</span> <span class="string">yaml</span> <span class="string">&gt;</span> <span class="string">web-deploy.yaml</span></span><br><span class="line"><span class="comment"># 使用 yaml 部署</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">web-deploy.yaml</span></span><br><span class="line"><span class="comment"># 查看资源</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">deploy</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">pods</span></span><br></pre></td></tr></table></figure></li>
<li><strong>创建 service，暴露对外端口号：</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">expose</span> <span class="string">deployment</span> <span class="string">web-deploy</span> <span class="string">--port=80</span> <span class="string">--type=NodePort</span> <span class="string">--target-port=80</span> <span class="string">--name=web-service</span> <span class="string">-o</span> <span class="string">yaml</span> <span class="string">&gt;</span> <span class="string">web-service.yaml</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">web-service.yaml</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">svc</span></span><br></pre></td></tr></table></figure></li>
<li><strong>应用升级回滚和弹性伸缩：</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用升级（更新 nginx 镜像版本）</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">set</span> <span class="string">image</span> <span class="string">deployment</span> <span class="string">web-deploy</span> <span class="string">nginx=nginx:1.15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看升级状态</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">rollout</span> <span class="string">status</span> <span class="string">deployment</span> <span class="string">web-deploy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看升级版本历史</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">rollout</span> <span class="string">history</span> <span class="string">deployment</span> <span class="string">web-deploy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到上一个版本</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">rollout</span> <span class="string">undo</span> <span class="string">deployment</span> <span class="string">web-deploy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到指定版本（比如 revision 2）</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">rollout</span> <span class="string">undo</span> <span class="string">deployment</span> <span class="string">web-deploy</span> <span class="string">--to-revision=2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 弹性伸缩（调整副本数量）</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">scale</span> <span class="string">deployment</span> <span class="string">web-deploy</span> <span class="string">--replicas=5</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                         </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                          </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-service</span>                    </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span>                       </span><br><span class="line">  <span class="attr">selector:</span>                            </span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-app</span>                            </span><br><span class="line">  <span class="attr">ports:</span>                                </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>                            </span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span>                      </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                     </span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span>                       <span class="comment"># 资源类型为 StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span>                              </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-statefulset</span>                           </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">my-service</span>               <span class="comment"># 引用 Service 的名称</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>                          </span><br><span class="line">  <span class="attr">selector:</span>                          </span><br><span class="line">    <span class="attr">matchLabels:</span>                       </span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span>                          </span><br><span class="line">  <span class="attr">template:</span>                             </span><br><span class="line">    <span class="attr">metadata:</span>                           </span><br><span class="line">      <span class="attr">labels:</span>                           </span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span>                        </span><br><span class="line">    <span class="attr">spec:</span>                               </span><br><span class="line">      <span class="attr">containers:</span>                       </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                     </span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:latest</span>                </span><br></pre></td></tr></table></figure>

<h3 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                    </span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span>                         <span class="comment"># 资源类型为 DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-daemonset</span>                         </span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span>                    </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">selector:</span>                             </span><br><span class="line">    <span class="attr">matchLabels:</span>                        </span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span>                      </span><br><span class="line">  <span class="attr">template:</span>                             </span><br><span class="line">    <span class="attr">metadata:</span>                           </span><br><span class="line">      <span class="attr">labels:</span>                           </span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span>                    </span><br><span class="line">    <span class="attr">spec:</span>                              </span><br><span class="line">      <span class="attr">containers:</span>                       </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fluentd</span>                   </span><br><span class="line">        <span class="attr">image:</span> <span class="string">fluentd:latest</span>           </span><br><span class="line">        <span class="attr">resources:</span>                    </span><br><span class="line">          <span class="attr">limits:</span>                      </span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;200m&quot;</span>                </span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span>            </span><br><span class="line">          <span class="attr">requests:</span>                    </span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span>                 </span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;256Mi&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Job-CronJob"><a href="#Job-CronJob" class="headerlink" title="Job&#x2F;CronJob"></a>Job&#x2F;CronJob</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span>                    </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span>                               <span class="comment"># 资源类型为 Job</span></span><br><span class="line"><span class="attr">metadata:</span>                              </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-job</span>                         </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">completions:</span> <span class="number">1</span>                        <span class="comment"># 任务需要成功完成的 Pod 数量</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">1</span>                        <span class="comment"># 同时运行的 Pod 数量</span></span><br><span class="line">  <span class="attr">template:</span>                             </span><br><span class="line">    <span class="attr">spec:</span>                               </span><br><span class="line">      <span class="attr">containers:</span>                       </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-job</span>               </span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:latest</span>           </span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;Job completed&#x27; &amp;&amp; sleep 5&quot;</span>]  <span class="comment"># 运行的命令，打印消息并休眠 5 秒</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span>              <span class="comment"># 重启策略，Never 表示 Pod 失败后不重启</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span>                   </span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span>                           <span class="comment"># 资源类型为 CronJob</span></span><br><span class="line"><span class="attr">metadata:</span>                              </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-cronjob</span>                  </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;*/5 * * * *&quot;</span>               <span class="comment"># 定时调度表达式，每 5 分钟运行一次</span></span><br><span class="line">  <span class="attr">jobTemplate:</span>                          <span class="comment"># Job 模板，定义每次调度的 Job 配置</span></span><br><span class="line">    <span class="attr">spec:</span>                               <span class="comment"># Job 的详细规范</span></span><br><span class="line">      <span class="attr">template:</span>                        </span><br><span class="line">        <span class="attr">spec:</span>                           <span class="comment"># Pod 的详细规范</span></span><br><span class="line">          <span class="attr">containers:</span>                   </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-cronjob</span>        </span><br><span class="line">            <span class="attr">image:</span> <span class="string">busybox:latest</span>       </span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo &#x27;CronJob ran at $(date)&#x27;&quot;</span>]  <span class="comment"># 运行的命令，打印当前时间</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span>          <span class="comment"># 重启策略，Never 表示 Pod 失败后不重启</span></span><br></pre></td></tr></table></figure>

<h2 id="K8S-Service"><a href="#K8S-Service" class="headerlink" title="K8S Service"></a>K8S Service</h2><h3 id="Service-概念"><a href="#Service-概念" class="headerlink" title="Service 概念"></a>Service 概念</h3><ul>
<li>定义一组 Pod 的访问规则。</li>
</ul>
<h3 id="Service-常用类型"><a href="#Service-常用类型" class="headerlink" title="Service 常用类型"></a>Service 常用类型</h3><ul>
<li><code>ClusterIP</code> 集群内部使用。</li>
<li><code>NodePort</code> 暴露端口给外部。</li>
<li><code>LoadBalancer</code> 提供负载均衡和外部访问，公有云。</li>
</ul>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                     </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                        </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-deployment</span>                        </span><br><span class="line"><span class="attr">spec:</span>                                 </span><br><span class="line">  <span class="attr">selector:</span>                             </span><br><span class="line">    <span class="attr">matchLabels:</span>                        </span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span>                          </span><br><span class="line">  <span class="attr">template:</span>                             </span><br><span class="line">    <span class="attr">metadata:</span>                         </span><br><span class="line">      <span class="attr">labels:</span>                           </span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span>                       </span><br><span class="line">    <span class="attr">spec:</span>                               </span><br><span class="line">      <span class="attr">containers:</span>                      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                   </span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:latest</span>               </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                           <span class="comment"># 资源类型为 Service</span></span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-service</span>                      <span class="comment"># Service 的名称</span></span><br><span class="line"><span class="attr">spec:</span>                                   <span class="comment"># Service 的详细规范</span></span><br><span class="line">  <span class="attr">selector:</span>                             <span class="comment"># 标签选择器，匹配后端 Pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-app</span>                         <span class="comment"># 标签键值对，匹配 Deployment 的 Pod 标签 </span></span><br><span class="line">  <span class="attr">ports:</span>                                <span class="comment"># 端口配置</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>                            <span class="comment"># Service 监听的端口</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>                      <span class="comment"># Pod 容器的目标端口</span></span><br></pre></td></tr></table></figure>


<h2 id="K8S-Secret"><a href="#K8S-Secret" class="headerlink" title="K8S Secret"></a>K8S Secret</h2><h3 id="Secret-作用"><a href="#Secret-作用" class="headerlink" title="Secret 作用"></a>Secret 作用</h3><ul>
<li>存储加密数据到 etcd， 让 Pod 容器以变量或 Volume 的方式挂载到容器中。</li>
<li>解决密码、token、密钥等敏感数据的配置问题，而不需要把这些敏感数据暴露到镜像或者 Pod Spec 中。</li>
</ul>
<h3 id="Secret-类型"><a href="#Secret-类型" class="headerlink" title="Secret 类型"></a>Secret 类型</h3><ul>
<li><code>Service Account</code> 用来访问 Kubernetes API,由 Kubernetes 自动创建，并且会自动挂载到 Pod 的 &#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount 目录中。</li>
<li><code>Opaque</code> base64 编码格式的 Secret,用来存储密码、密钥等。</li>
<li><code>kubernetes.io/dockerconfigjson</code> 用来存储私有 docker registry 的认证信息。</li>
</ul>
<h3 id="Secret-创建"><a href="#Secret-创建" class="headerlink" title="Secret 创建"></a>Secret 创建</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span>                           </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span>                       </span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span>                            <span class="comment"># Secret 类型</span></span><br><span class="line"><span class="attr">data:</span>                                   </span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span>                    <span class="comment"># 用户名，Base64 编码的 &quot;admin&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzNDU2</span>                    <span class="comment"># 密码，Base64 编码的 &quot;123456&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure>

<h3 id="Secret-挂载"><a href="#Secret-挂载" class="headerlink" title="Secret 挂载"></a>Secret 挂载</h3><ul>
<li><p><strong>方式一：变量</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                               </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>                       </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">containers:</span>                           </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                         </span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span>                </span><br><span class="line">      <span class="attr">env:</span>                                  <span class="comment"># 环境变量配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">USERNAME</span>                    <span class="comment"># 环境变量名</span></span><br><span class="line">          <span class="attr">valueFrom:</span>                        <span class="comment"># 从 Secret 引用值</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span>                   <span class="comment"># 引用 Secret 的键</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">my-secret</span>               <span class="comment"># Secret 的名称</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">username</span>                 <span class="comment"># Secret 中的键 &quot;admin&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PASSWORD</span>                    <span class="comment"># 环境变量名</span></span><br><span class="line">          <span class="attr">valueFrom:</span>                        </span><br><span class="line">            <span class="attr">secretKeyRef:</span>                   </span><br><span class="line">              <span class="attr">name:</span> <span class="string">my-secret</span>               <span class="comment"># Secret 的名称</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">password</span>                 <span class="comment"># Secret 中的键 &quot;123456&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证环境变量</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">exec</span> <span class="string">my-pod</span> <span class="string">--env</span></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># USERNAME=admin</span></span><br><span class="line"><span class="comment"># PASSWORD=123456</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>方式二：Volume</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                              </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>                       </span><br><span class="line"><span class="attr">spec:</span>                                  </span><br><span class="line">  <span class="attr">containers:</span>                         </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                    </span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span>                  </span><br><span class="line">      <span class="attr">volumeMounts:</span>                       <span class="comment"># 容器挂载的卷</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span>             <span class="comment"># 卷名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/secrets</span>         <span class="comment"># 挂载路径，Secret 文件将出现在此目录</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span>                  <span class="comment"># 挂载为只读</span></span><br><span class="line">  <span class="attr">volumes:</span>                                <span class="comment"># Pod 的卷定义</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span>                 <span class="comment"># 卷名称</span></span><br><span class="line">      <span class="attr">secret:</span>                             <span class="comment"># 卷类型为 Secret</span></span><br><span class="line">        <span class="attr">secretName:</span> <span class="string">my-secret</span>             <span class="comment"># 引用的 Secret 名称</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证 Volume 挂载文件</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">exec</span> <span class="string">my-pod</span> <span class="string">--</span> <span class="string">cat</span> <span class="string">/etc/secrets/username</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">exec</span> <span class="string">my-pod</span> <span class="string">--</span> <span class="string">cat</span> <span class="string">/etc/secrets/password</span></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># admin</span></span><br><span class="line"><span class="comment"># 123456</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="K8S-ConfigMap"><a href="#K8S-ConfigMap" class="headerlink" title="K8S ConfigMap"></a>K8S ConfigMap</h2><h3 id="ConfigMap-作用"><a href="#ConfigMap-作用" class="headerlink" title="ConfigMap 作用"></a>ConfigMap 作用</h3><ul>
<li>存储不加密数据到 etcd， 让 Pod 容器以变量或 Volume 的方式挂载到容器中。</li>
</ul>
<h3 id="ConfigMap-创建"><a href="#ConfigMap-创建" class="headerlink" title="ConfigMap 创建"></a>ConfigMap 创建</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                        </span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span>                        </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-config</span>                       </span><br><span class="line"><span class="attr">data:</span>                                   </span><br><span class="line">  <span class="attr">app.conf:</span> <span class="string">|</span>                           <span class="comment"># 键 app.conf，值是一个多行配置文件</span></span><br><span class="line">    <span class="string">server.port=8080</span>                    <span class="comment"># 示例配置：服务端口</span></span><br><span class="line">    <span class="string">log.level=info</span>                      <span class="comment"># 示例配置：日志级别</span></span><br><span class="line">  <span class="attr">key1:</span> <span class="string">value1</span>                          <span class="comment"># 键值对，key1 的值为 value1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">cm</span></span><br></pre></td></tr></table></figure>

<h3 id="ConfigMap-挂载"><a href="#ConfigMap-挂载" class="headerlink" title="ConfigMap 挂载"></a>ConfigMap 挂载</h3><ul>
<li><p><strong>方式一：变量</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                          </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                              </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>                       </span><br><span class="line"><span class="attr">spec:</span>                                 </span><br><span class="line">  <span class="attr">containers:</span>                       </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                       </span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span>              </span><br><span class="line">      <span class="attr">env:</span>                                  <span class="comment"># 环境变量配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KEY1</span>                        <span class="comment"># 环境变量名</span></span><br><span class="line">          <span class="attr">valueFrom:</span>                        <span class="comment"># 从 ConfigMap 引用值</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span>                <span class="comment"># 引用 ConfigMap 的键</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">my-config</span>               <span class="comment"># ConfigMap 的名称</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">key1</span>                     <span class="comment"># ConfigMap 中的键</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_CONFIG</span>                  <span class="comment"># 环境变量名</span></span><br><span class="line">          <span class="attr">valueFrom:</span>                        </span><br><span class="line">            <span class="attr">configMapKeyRef:</span>               </span><br><span class="line">              <span class="attr">name:</span> <span class="string">my-config</span>               <span class="comment"># ConfigMap 的名称</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">app.conf</span>                 <span class="comment"># ConfigMap 中的键</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证环境变量</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">exec</span> <span class="string">my-pod</span> <span class="string">--env</span></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># KEY1=value1</span></span><br><span class="line"><span class="comment"># APP_CONFIG=server.port=8080</span></span><br><span class="line"><span class="comment"># log.level=info</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>方式二：Volume</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                         </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                               </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pod</span>                      </span><br><span class="line"><span class="attr">spec:</span>                                </span><br><span class="line">  <span class="attr">containers:</span>                          </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                       </span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span>                      </span><br><span class="line">      <span class="attr">volumeMounts:</span>                         <span class="comment"># 容器挂载的卷</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>               <span class="comment"># 卷名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/config</span>            <span class="comment"># 挂载路径，ConfigMap 文件将出现在此目录</span></span><br><span class="line">  <span class="attr">volumes:</span>                                  <span class="comment"># Pod 的卷定义</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>                   <span class="comment"># 卷名称</span></span><br><span class="line">      <span class="attr">configMap:</span>                            <span class="comment"># 卷类型为 ConfigMap</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-config</span>                     <span class="comment"># 引用的 ConfigMap 名称</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证 Volume 挂载文件</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">exec</span> <span class="string">my-pod</span> <span class="string">--</span> <span class="string">cat</span> <span class="string">/etc/config/key1</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">exec</span> <span class="string">nginx-pod</span> <span class="string">--</span> <span class="string">cat</span> <span class="string">/etc/config/app.conf</span></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># value1</span></span><br><span class="line"><span class="comment"># server.port=8080</span></span><br><span class="line"><span class="comment"># log.level=info</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="K8S-集群安全机制-RBAC"><a href="#K8S-集群安全机制-RBAC" class="headerlink" title="K8S 集群安全机制 RBAC"></a>K8S 集群安全机制 RBAC</h2><h3 id="集群安全机制"><a href="#集群安全机制" class="headerlink" title="集群安全机制"></a>集群安全机制</h3><ul>
<li><p><strong>第一步：认证</strong></p>
<ul>
<li>传输安全：对外不暴露 8080 端口，只能内部访问，对外使用端口 6443</li>
<li>认证：客户端身份认证常用方式<ul>
<li>https 证书认证，基于 ca 证书</li>
<li>http token 认证，通过 token 识别用户</li>
<li>http 基本认证，用户名 + 密码认证</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>第二步：鉴权（授权）</strong></p>
<ul>
<li>基于 RBAC 进行鉴权操作</li>
<li>基于角色访问控制</li>
</ul>
</li>
<li><p><strong>第三步：准入控制</strong></p>
<ul>
<li>就是准入控制器的列表，如果列表有请求内容则通过，没有则拒绝</li>
</ul>
</li>
</ul>
<h3 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h3><ul>
<li><strong>角色</strong><ul>
<li><code>role</code> 特定命名空间访问权限</li>
<li><code>ClusterRole</code> 所有命名空间访问权限</li>
</ul>
</li>
<li><strong>角色绑定</strong><ul>
<li><code>roleBinding</code> 角色绑定到主体</li>
<li><code>ClusterRoleBinding</code> 集群角色绑定到主体</li>
</ul>
</li>
<li><strong>主体</strong><ul>
<li><code>user</code> 用户</li>
<li><code>group</code> 用户组</li>
<li><code>serviceAccount</code> 服务账号</li>
</ul>
</li>
</ul>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建命名空间（可选，如果命名空间不存在）</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-namespace</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 创建 ServiceAccount（模拟用户）</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">my-namespace</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 创建 Role（定义权限规则）</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-manager</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">my-namespace</span></span><br><span class="line"><span class="attr">rules:</span>                                                   <span class="comment"># 定义权限规则</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]                                      <span class="comment"># 指定核心 API 组（&quot;&quot; 表示核心资源，如 pods）</span></span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]                                  <span class="comment"># 指定受控资源为 pods</span></span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]  <span class="comment"># 允许的操作：获取、列出、监视、创建、删除</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 创建 RoleBinding（将 Role 绑定到 ServiceAccount）</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-manager-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">my-namespace</span></span><br><span class="line"><span class="attr">subjects:</span>                                                <span class="comment"># 定义绑定主体</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>                                 <span class="comment"># 指定主体类型为 ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">my-user</span>                                        <span class="comment"># 指定主体名称为 my-user</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">my-namespace</span>                              <span class="comment"># 指定主体所在的命名空间</span></span><br><span class="line"><span class="attr">roleRef:</span>                                                 <span class="comment"># 定义绑定的角色</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span>                                             <span class="comment"># 指定引用的角色类型为 Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-manager</span>                                      <span class="comment"># 指定引用的角色名称为 pod-manager</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>                    <span class="comment"># 指定角色所属的 API 组</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证 RBAC 配置</span></span><br><span class="line"><span class="comment"># 获取 ServiceAccount 的 Token</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">-n</span> <span class="string">my-namespace</span> <span class="string">get</span> <span class="string">secret</span> <span class="string">$(kubectl</span> <span class="string">-n</span> <span class="string">my-namespace</span> <span class="string">get</span> <span class="string">sa</span> <span class="string">my-user</span> <span class="string">-o</span> <span class="string">jsonpath=&#x27;&#123;.secrets[0].name&#125;&#x27;)</span> <span class="string">-o</span> <span class="string">jsonpath=&#x27;&#123;.data.token&#125;&#x27;</span> <span class="string">|</span> <span class="string">base64</span> <span class="string">-d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Token 访问 API，验证权限</span></span><br><span class="line"><span class="string">curl</span> <span class="string">-k</span> <span class="string">-H</span> <span class="string">&quot;Authorization: Bearer &lt;TOKEN&gt;&quot;</span> <span class="string">https://&lt;K8S_API_SERVER&gt;/api/v1/namespaces/my-namespace/pods</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试权限：</span></span><br><span class="line"><span class="comment"># 检查是否可以获取 Pods</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">--namespace=my-namespace</span> <span class="string">auth</span> <span class="string">can-i</span> <span class="string">get</span> <span class="string">pods</span> <span class="string">--as=system:serviceaccount:my-namespace:my-user</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 检查是否可以创建 Deployments</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">--namespace=my-namespace</span> <span class="string">auth</span> <span class="string">can-i</span> <span class="string">create</span> <span class="string">deployments</span> <span class="string">--as=system:serviceaccount:my-namespace:my-user</span></span><br></pre></td></tr></table></figure>


<h2 id="K8S-Ingress"><a href="#K8S-Ingress" class="headerlink" title="K8S Ingress"></a>K8S Ingress</h2><h3 id="Ingress-作用"><a href="#Ingress-作用" class="headerlink" title="Ingress 作用"></a>Ingress 作用</h3><ul>
<li>Ingress 负责定义路由规则（如 <code>example.com/</code> 路由到某个 Service。</li>
<li>支持 HTTPS、负载均衡、URL 重写等高级功能。</li>
<li>相比直接使用 Service 的 NodePort 或 LoadBalancer，Ingress 更灵活且节省资源。</li>
</ul>
<h3 id="Ingress-Controller"><a href="#Ingress-Controller" class="headerlink" title="Ingress Controller"></a>Ingress Controller</h3><ul>
<li>Ingress Controller 负责解析规则并处理流量。若没有 Controller，Ingress 资源只是无效的配置，无法响应请求。</li>
<li>监听 Kubernetes API，读取 Ingress 资源，动态生成路由配置（如 Nginx 的 <code>nginx.conf</code>）。</li>
<li>接收外部 HTTP&#x2F;HTTPS 请求，根据 Ingress 规则转发到后端 Service 和 Pod。</li>
<li>提供负载均衡、SSL 终止、路径重写等功能。</li>
</ul>
<h3 id="Ingress-使用"><a href="#Ingress-使用" class="headerlink" title="Ingress 使用"></a>Ingress 使用</h3><ul>
<li>部署 Ingress Controller<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">pods</span> <span class="string">-n</span> <span class="string">ingress-nginx</span></span><br></pre></td></tr></table></figure></li>
<li>部署 Ingress<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                     </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                       </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span>                            </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>                           </span><br><span class="line">  <span class="attr">selector:</span>                            </span><br><span class="line">    <span class="attr">matchLabels:</span>                        </span><br><span class="line">      <span class="attr">app:</span> <span class="string">web</span>                          </span><br><span class="line">  <span class="attr">template:</span>                             </span><br><span class="line">    <span class="attr">metadata:</span>                          </span><br><span class="line">      <span class="attr">labels:</span>                          </span><br><span class="line">        <span class="attr">app:</span> <span class="string">web</span>                        </span><br><span class="line">    <span class="attr">spec:</span>                              </span><br><span class="line">      <span class="attr">containers:</span>                      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                     </span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:latest</span>             </span><br><span class="line">        <span class="attr">ports:</span>                          <span class="comment"># 容器暴露的端口</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span>             <span class="comment"># 容器端口 80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                         </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                         </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-service</span>                    </span><br><span class="line"><span class="attr">spec:</span>                                   </span><br><span class="line">  <span class="attr">selector:</span>                            </span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span>                           </span><br><span class="line">  <span class="attr">ports:</span>                                <span class="comment"># 端口配置</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>                            <span class="comment"># Service 监听的端口</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>                      <span class="comment"># Pod 容器的目标端口</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Ingress</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span>       </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span>                          <span class="comment"># 资源类型为 Ingress  </span></span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-ingress</span>                    </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span>                                <span class="comment"># 路由规则列表</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">example.com</span>                   <span class="comment"># 匹配的主机域名</span></span><br><span class="line">    <span class="attr">http:</span>                               <span class="comment"># HTTP 协议配置</span></span><br><span class="line">      <span class="attr">paths:</span>                            <span class="comment"># 路径规则</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span>                         <span class="comment"># 匹配的路径（根路径）</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span>                <span class="comment"># 路径类型，Prefix 表示前缀匹配</span></span><br><span class="line">        <span class="attr">backend:</span>                        <span class="comment"># 后端服务</span></span><br><span class="line">          <span class="attr">service:</span>                      <span class="comment"># 目标 Service</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">web-service</span>           <span class="comment"># Service 名称</span></span><br><span class="line">            <span class="attr">port:</span>                       <span class="comment"># Service 端口</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span>                <span class="comment"># 端口号</span></span><br></pre></td></tr></table></figure></li>
<li>配置 Host<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Host 配置</span></span><br><span class="line">&lt;Ingress-Controller-IP&gt; example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">curl http://example.com</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="K8S-Helm-包管理"><a href="#K8S-Helm-包管理" class="headerlink" title="K8S Helm 包管理"></a>K8S Helm 包管理</h2><h3 id="Helm-介绍"><a href="#Helm-介绍" class="headerlink" title="Helm 介绍"></a>Helm 介绍</h3><ul>
<li>包管理工具，用于简化应用的部署和管理。</li>
</ul>
<h3 id="Helm-作用"><a href="#Helm-作用" class="headerlink" title="Helm 作用"></a>Helm 作用</h3><ul>
<li><strong>模板化：</strong> 通过变量和模板复用 YAML 配置。</li>
<li><strong>版本管理：</strong> 支持应用的版本控制和回滚。</li>
<li><strong>简化部署：</strong> 一条命令部署复杂应用（如 helm install）。</li>
</ul>
<h3 id="Helm-核心概念"><a href="#Helm-核心概念" class="headerlink" title="Helm 核心概念"></a>Helm 核心概念</h3><ul>
<li><code>Helm</code> 是一个命令行客户端工具。</li>
<li><code>Chart</code> 把 yaml 打包，是 yaml 集合。</li>
<li><code>Release</code> 基于 Chart 部署实体，应用级别的版本管理。</li>
</ul>
<h3 id="Helm-客户端"><a href="#Helm-客户端" class="headerlink" title="Helm 客户端"></a>Helm 客户端</h3><p>Helm 客户端下载地址：<a target="_blank" rel="noopener" href="https://github.com/helm/helm/releases">https://github.com/helm/helm/releases</a><br>下载解压移动到&#x2F;usr&#x2F;bin&#x2F;目录即可</p>
<h3 id="Helm-配置-Chart-仓库地址"><a href="#Helm-配置-Chart-仓库地址" class="headerlink" title="Helm 配置 Chart 仓库地址"></a>Helm 配置 Chart 仓库地址</h3><ul>
<li>微软：<a target="_blank" rel="noopener" href="https://mirror.azure.cn/kubernetes/charts/">https://mirror.azure.cn/kubernetes/charts/</a></li>
<li>阿里：<a target="_blank" rel="noopener" href="https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts">https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出存储库</span></span><br><span class="line">helm repo list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加存储库</span></span><br><span class="line">helm repo add &lt;仓库名称&gt; &lt;仓库地址&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除存储库</span></span><br><span class="line">helm repo remove &lt;仓库名称&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新存储库</span></span><br><span class="line">helm repo update</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Helm-常用命令"><a href="#Helm-常用命令" class="headerlink" title="Helm 常用命令"></a>Helm 常用命令</h3><ul>
<li>搜索和查看 Chart<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在本地配置的仓库中搜索 Chart</span></span><br><span class="line">helm search repo [KEYWORD]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 Artifact Hub（Helm 官方 Chart 中心）搜索 Chart</span></span><br><span class="line">helm search hub [KEYWORD]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定 Chart 的元信息（如版本、描述）</span></span><br><span class="line">helm show chart [CHART]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Chart 的默认 values.yaml 配置</span></span><br><span class="line">helm show values [CHART]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Chart 的 README 文档</span></span><br><span class="line">helm show readme [CHART]</span><br></pre></td></tr></table></figure></li>
<li>安装和升级<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Chart 到 Kubernetes 集群</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> [<span class="string">RELEASE_NAME</span>] [<span class="string">CHART</span>] [<span class="string">FLAGS</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级已安装的 Release（支持修改配置或 Chart 版本）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">upgrade</span> [<span class="string">RELEASE_NAME</span>] [<span class="string">CHART</span>] [<span class="string">FLAGS</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到指定版本的 Release</span></span><br><span class="line"><span class="string">helm</span> <span class="string">rollback</span> [<span class="string">RELEASE_NAME</span>] [<span class="string">REVISION</span>]</span><br></pre></td></tr></table></figure></li>
<li>管理 Release<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出当前命名空间中的 Release</span></span><br><span class="line"><span class="string">helm</span> <span class="string">list</span> [<span class="string">FLAGS</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定 Release 的状态（包括资源和配置）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">status</span> [<span class="string">RELEASE_NAME</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定 Release 的修订历史</span></span><br><span class="line"><span class="string">helm</span> <span class="string">history</span> [<span class="string">RELEASE_NAME</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定 Release（卸载应用）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">uninstall</span> [<span class="string">RELEASE_NAME</span>]</span><br></pre></td></tr></table></figure></li>
<li>打包和发布 Chart<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新的 Chart 模板目录</span></span><br><span class="line"><span class="string">helm</span> <span class="string">create</span> [<span class="string">NAME</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 Chart 打包为 .tgz 文件</span></span><br><span class="line"><span class="string">helm</span> <span class="string">package</span> [<span class="string">CHART_PATH</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 Chart 的语法和格式是否正确</span></span><br><span class="line"><span class="string">helm</span> <span class="string">lint</span> [<span class="string">CHART_PATH</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将打包的 Chart 推送到远程 Chart 仓库（需仓库支持）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">push</span> [<span class="string">CHART_TGZ</span>] [<span class="string">REPO</span>]</span><br></pre></td></tr></table></figure></li>
<li>调试和验证<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 渲染 Chart 模板，生成 Kubernetes 清单（不实际部署）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">template</span> [<span class="string">RELEASE_NAME</span>] [<span class="string">CHART</span>] [<span class="string">FLAGS</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟安装过程，输出渲染的 Kubernetes 清单，不实际部署</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> <span class="string">--dry-run</span> [<span class="string">RELEASE_NAME</span>] [<span class="string">CHART</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 Release 的详细信息</span></span><br><span class="line"><span class="string">helm</span> <span class="string">get</span> [<span class="string">SUBCOMMAND</span>] [<span class="string">RELEASE_NAME</span>]</span><br></pre></td></tr></table></figure></li>
<li>依赖管理<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 Chart 依赖到 Chart.yaml</span></span><br><span class="line"><span class="string">helm</span> <span class="string">dependency</span> <span class="string">add</span> [<span class="string">CHART</span>] [<span class="string">REPO</span>] [<span class="string">VERSION</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 Chart 的依赖（下载依赖到 charts/ 目录）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">dependency</span> <span class="string">update</span> [<span class="string">CHART_PATH</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出 Chart 的依赖</span></span><br><span class="line"><span class="string">helm</span> <span class="string">dependency</span> <span class="string">list</span> [<span class="string">CHART_PATH</span>]</span><br></pre></td></tr></table></figure></li>
<li>插件管理<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Helm 插件</span></span><br><span class="line"><span class="string">helm</span> <span class="string">plugin</span> <span class="string">install</span> [<span class="string">URL</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出已安装的插件</span></span><br><span class="line"><span class="string">helm</span> <span class="string">plugin</span> <span class="string">list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载指定插件</span></span><br><span class="line"><span class="string">helm</span> <span class="string">plugin</span> <span class="string">uninstall</span> [<span class="string">PLUGIN</span>]</span><br></pre></td></tr></table></figure></li>
<li>环境和配置<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示 Helm 的环境变量（如缓存路径、配置路径）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">env</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 Shell 自动补全脚本（支持 bash、zsh、fish）</span></span><br><span class="line"><span class="string">helm</span> <span class="string">completion</span> [<span class="string">SHELL</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Helm-快速部署应用"><a href="#Helm-快速部署应用" class="headerlink" title="Helm 快速部署应用"></a>Helm 快速部署应用</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索应用</span></span><br><span class="line"><span class="string">helm</span> <span class="string">search</span> <span class="string">repo</span> <span class="string">weave</span></span><br><span class="line"><span class="comment"># 安装应用</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> <span class="string">ui</span> <span class="string">stable/weave-scope</span></span><br><span class="line"><span class="comment"># 查看应用</span></span><br><span class="line"><span class="string">helm</span> <span class="string">list</span></span><br><span class="line"><span class="string">helm</span> <span class="string">status</span> <span class="string">ui</span></span><br></pre></td></tr></table></figure>

<h3 id="Helm-自定义-Chart-部署"><a href="#Helm-自定义-Chart-部署" class="headerlink" title="Helm 自定义 Chart 部署"></a>Helm 自定义 Chart 部署</h3><ul>
<li>创建自定义 Chart<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个 mychart 目录，里面包含如下：</span></span><br><span class="line"><span class="comment"># charts：空目录，普通文件夹</span></span><br><span class="line"><span class="comment"># Chart.yaml：基本信息，版本、名称等内容</span></span><br><span class="line"><span class="comment"># templates：自定义的 yaml 文件目录</span></span><br><span class="line"><span class="comment"># values.yaml：自定义的 yaml 文件的全局变量定义</span></span><br><span class="line"><span class="string">helm</span> <span class="string">create</span> <span class="string">mychart</span></span><br></pre></td></tr></table></figure></li>
<li>templates 中创建自定义的 yaml(<code>my-deployment.yaml</code>、<code>my-service.yaml</code>)<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></li>
<li>安装自定义 Chart<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install myweb mychart</span><br></pre></td></tr></table></figure></li>
<li>应用升级 Chart<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm upgrade myweb mychart</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Helm-Chart-模版"><a href="#Helm-Chart-模版" class="headerlink" title="Helm Chart 模版"></a>Helm Chart 模版</h3><ul>
<li>在 value.yaml 定义变量和值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">label: nginx</span><br><span class="line">image: nginx</span><br><span class="line">prot: 80</span><br></pre></td></tr></table></figure></li>
<li>在 templates 的 yaml 文件使用 value.yaml 定义变量和值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过表达式形式</span></span><br><span class="line">&#123;&#123; .Value.变量名称 &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内置对象</span></span><br><span class="line">&#123;&#123; .Release.Name &#125;&#125;       <span class="comment"># Release 名字</span></span><br><span class="line">&#123;&#123; .Release.Namespace &#125;&#125;  <span class="comment"># Release 命名空间</span></span><br><span class="line">&#123;&#123; .Release.Service &#125;&#125;    <span class="comment"># Release 服务名称</span></span><br><span class="line">&#123;&#123; .Release.Revision &#125;&#125;   <span class="comment"># Release 修订版本号，从1开始累加</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="K8S-持久化存储"><a href="#K8S-持久化存储" class="headerlink" title="K8S 持久化存储"></a>K8S 持久化存储</h2><h3 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h3><ul>
<li>新节点安装 NFS<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 NFS</span></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置挂载路径</span></span><br><span class="line">vi /etc/exports</span><br><span class="line">/data/nfs *(rw,no_root_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建挂载路径</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /data/nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 NFS 服务</span></span><br><span class="line">systemctl start nfs</span><br></pre></td></tr></table></figure></li>
<li>K8S 集群节点安装 NFS<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 NFS</span></span><br><span class="line">yum install -y nfs-utils</span><br></pre></td></tr></table></figure></li>
<li>部署应用使用 NFS 持久存储<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                     </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                        </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-deployment</span>               </span><br><span class="line"><span class="attr">spec:</span>                                  </span><br><span class="line">  <span class="attr">selector:</span>                             </span><br><span class="line">    <span class="attr">matchLabels:</span>                        </span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span>                       </span><br><span class="line">  <span class="attr">template:</span>                             </span><br><span class="line">    <span class="attr">metadata:</span>                           </span><br><span class="line">      <span class="attr">labels:</span>                           </span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span>                     </span><br><span class="line">    <span class="attr">spec:</span>                               </span><br><span class="line">      <span class="attr">containers:</span>                       </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                    </span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:latest</span>                   </span><br><span class="line">          <span class="attr">volumeMounts:</span>                             <span class="comment"># 容器挂载的卷</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span>                      <span class="comment"># 卷名称</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span>      <span class="comment"># 挂载路径，Nginx 的默认 Web 目录</span></span><br><span class="line">      <span class="attr">volumes:</span>                                      <span class="comment"># Pod 的卷定义</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span>                          <span class="comment"># 卷名称</span></span><br><span class="line">          <span class="attr">nfs:</span>                                      <span class="comment"># 引用 NFS</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span>                     <span class="comment"># NFS 服务节点地址</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/data/nfs</span>                         <span class="comment"># NFS 挂载路径</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="PV、PVC"><a href="#PV、PVC" class="headerlink" title="PV、PVC"></a>PV、PVC</h3><ul>
<li><code>PV</code> 持久化存储，对存储资源进行抽象，对外提供可以调用的地方（生产者）</li>
<li><code>PVC</code> 用于调用，不需要关系内部实现细节（消费者）</li>
<li><strong>PV、PVC 流程：</strong> <code>应用部署</code> -&gt; <code>定义PVC（绑定PV）</code>-&gt; <code>定义PV（数据存储服务器IP、路径）</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-app</span></span><br><span class="line">  <span class="attr">containers:</span>                          </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>                       </span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">      <span class="attr">volumeMounts:</span>                      </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span>                  <span class="comment"># 卷名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span>  <span class="comment"># 挂载路径，Nginx 的默认 Web 目录</span></span><br><span class="line">  <span class="attr">volumes:</span>                                  <span class="comment"># Pod 的卷定义</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span>                      <span class="comment"># 卷名称</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span>                <span class="comment"># 引用 PVC</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">my-pvc</span>                   <span class="comment"># PVC 名称</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span>                 </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span>                              <span class="comment"># 访问模式，与 PV 匹配</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>                         <span class="comment"># 支持多节点读写</span></span><br><span class="line">  <span class="attr">resources:</span>                                <span class="comment"># 请求资源</span></span><br><span class="line">    <span class="attr">requests:</span>                               <span class="comment"># 最小需求</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span>                          <span class="comment"># 请求 1Gi 存储</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># PersistentVolume</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                         </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span>                     </span><br><span class="line"><span class="attr">metadata:</span>                               </span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-pv</span>                         </span><br><span class="line"><span class="attr">spec:</span>                                  </span><br><span class="line">  <span class="attr">capacity:</span>                                 <span class="comment"># 存储容量</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span>                            <span class="comment"># 分配 1Gi 存储</span></span><br><span class="line">  <span class="attr">accessModes:</span>                              <span class="comment"># 访问模式</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>                         <span class="comment"># 支持多节点读写（NFS 特性）</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span>     <span class="comment"># 回收策略：保留 PV</span></span><br><span class="line">  <span class="attr">nfs:</span>                                      <span class="comment"># NFS 存储配置</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span>                     <span class="comment"># NFS 服务器 IP</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/data/nfs</span>                         <span class="comment"># NFS 共享目录</span></span><br></pre></td></tr></table></figure>

<h2 id="K8S-监控平台"><a href="#K8S-监控平台" class="headerlink" title="K8S 监控平台"></a>K8S 监控平台</h2><h3 id="监控指标"><a href="#监控指标" class="headerlink" title="监控指标"></a>监控指标</h3><ul>
<li><strong>集群监控：</strong> 节点资源利用率、节点数、运行pods</li>
<li><strong>Pod 监控：</strong> 容器指标、应用程序</li>
</ul>
<h3 id="Prometheus-Grafana"><a href="#Prometheus-Grafana" class="headerlink" title="Prometheus + Grafana"></a>Prometheus + Grafana</h3><ul>
<li><strong>Prometheus</strong><ul>
<li>开源的</li>
<li>监控、报警、数据库</li>
<li>以 HTTP 协议周期性抓取被监控组件状态</li>
<li>不需要复杂的集成过程，使用 HTTP 接口接入就可以了</li>
</ul>
</li>
<li><strong>Grafana</strong><ul>
<li>开源的数据分析和可视化工具</li>
<li>支持多种数据源</li>
</ul>
</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/">K8S 官网</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag"><i class="fa fa-tag"></i> 后端</a>
              <a href="/tags/Kubernetes/" rel="tag"><i class="fa fa-tag"></i> Kubernetes</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/JDK/JDK24%EF%BC%9A%E6%96%B0%E7%89%B9%E6%80%A7/" rel="prev" title="JDK24：新特性">
      <i class="fa fa-chevron-left"></i> JDK24：新特性
    </a></div>
      <div class="post-nav-item">
    <a href="/Nginx/Nginx/" rel="next" title="Nginx">
      Nginx <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">K8S 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#K8S-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">K8S 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K8S%E7%89%B9%E6%80%A7"><span class="nav-number">1.2.</span> <span class="nav-text">K8S特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K8S-%E6%9E%B6%E6%9E%84%E7%BB%84%E4%BB%B6"><span class="nav-number">1.3.</span> <span class="nav-text">K8S 架构组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K8S-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">1.4.</span> <span class="nav-text">K8S 核心概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="nav-number">2.</span> <span class="nav-text">K8S 集群搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%A6%81%E6%B1%82"><span class="nav-number">2.1.</span> <span class="nav-text">安装要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">系统初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9Akubeadm"><span class="nav-number">2.3.</span> <span class="nav-text">方式一：kubeadm</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Docker-kubeadm-kubelet"><span class="nav-number">2.3.1.</span> <span class="nav-text">安装 Docker&#x2F;kubeadm&#x2F;kubelet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-Kubernetes-Master"><span class="nav-number">2.3.2.</span> <span class="nav-text">部署 Kubernetes Master</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-Kubernetes"><span class="nav-number">2.3.3.</span> <span class="nav-text">测试 Kubernetes</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85"><span class="nav-number">2.4.</span> <span class="nav-text">方式二：二进制包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9A%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4"><span class="nav-number">2.5.</span> <span class="nav-text">方式三：高可用集群</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Kubectl%E5%91%BD%E4%BB%A4"><span class="nav-number">3.</span> <span class="nav-text">K8S Kubectl命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-YAML%E6%96%87%E4%BB%B6"><span class="nav-number">4.</span> <span class="nav-text">K8S YAML文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#YAML-%E6%96%87%E4%BB%B6%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90"><span class="nav-number">4.1.</span> <span class="nav-text">YAML 文件快速生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#YAML-%E6%96%87%E4%BB%B6%E5%BF%85%E9%A1%BB%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.</span> <span class="nav-text">YAML 文件必须属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Pod"><span class="nav-number">5.</span> <span class="nav-text">K8S Pod</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E6%A6%82%E5%BF%B5"><span class="nav-number">5.1.</span> <span class="nav-text">Pod 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E5%AD%98%E5%9C%A8%E7%9A%84%E6%84%8F%E4%B9%89"><span class="nav-number">5.2.</span> <span class="nav-text">Pod 存在的意义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="nav-number">5.3.</span> <span class="nav-text">Pod 实现机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E7%AD%96%E7%95%A5"><span class="nav-number">5.4.</span> <span class="nav-text">Pod 镜像拉取策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"><span class="nav-number">5.5.</span> <span class="nav-text">Pod 资源限制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5"><span class="nav-number">5.6.</span> <span class="nav-text">Pod 重启策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="nav-number">5.7.</span> <span class="nav-text">Pod 健康检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="nav-number">5.8.</span> <span class="nav-text">Pod 创建流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-%E8%B0%83%E5%BA%A6%E9%99%90%E5%88%B6"><span class="nav-number">5.9.</span> <span class="nav-text">Pod 调度限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Controller"><span class="nav-number">6.</span> <span class="nav-text">K8S Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller-%E6%A6%82%E5%BF%B5"><span class="nav-number">6.1.</span> <span class="nav-text">Controller 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller-%E4%BD%9C%E7%94%A8"><span class="nav-number">6.2.</span> <span class="nav-text">Controller 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller-%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.3.</span> <span class="nav-text">Controller 常用类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E7%8A%B6%E6%80%81%E4%B8%8E%E6%9C%89%E7%8A%B6%E6%80%81%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">6.4.</span> <span class="nav-text">无状态与有状态的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deployment"><span class="nav-number">6.5.</span> <span class="nav-text">Deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StatefulSet"><span class="nav-number">6.6.</span> <span class="nav-text">StatefulSet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DaemonSet"><span class="nav-number">6.7.</span> <span class="nav-text">DaemonSet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Job-CronJob"><span class="nav-number">6.8.</span> <span class="nav-text">Job&#x2F;CronJob</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Service"><span class="nav-number">7.</span> <span class="nav-text">K8S Service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-%E6%A6%82%E5%BF%B5"><span class="nav-number">7.1.</span> <span class="nav-text">Service 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.2.</span> <span class="nav-text">Service 常用类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service"><span class="nav-number">7.3.</span> <span class="nav-text">Service</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Secret"><span class="nav-number">8.</span> <span class="nav-text">K8S Secret</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Secret-%E4%BD%9C%E7%94%A8"><span class="nav-number">8.1.</span> <span class="nav-text">Secret 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secret-%E7%B1%BB%E5%9E%8B"><span class="nav-number">8.2.</span> <span class="nav-text">Secret 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secret-%E5%88%9B%E5%BB%BA"><span class="nav-number">8.3.</span> <span class="nav-text">Secret 创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Secret-%E6%8C%82%E8%BD%BD"><span class="nav-number">8.4.</span> <span class="nav-text">Secret 挂载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-ConfigMap"><span class="nav-number">9.</span> <span class="nav-text">K8S ConfigMap</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfigMap-%E4%BD%9C%E7%94%A8"><span class="nav-number">9.1.</span> <span class="nav-text">ConfigMap 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfigMap-%E5%88%9B%E5%BB%BA"><span class="nav-number">9.2.</span> <span class="nav-text">ConfigMap 创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfigMap-%E6%8C%82%E8%BD%BD"><span class="nav-number">9.3.</span> <span class="nav-text">ConfigMap 挂载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6-RBAC"><span class="nav-number">10.</span> <span class="nav-text">K8S 集群安全机制 RBAC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="nav-number">10.1.</span> <span class="nav-text">集群安全机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RBAC"><span class="nav-number">10.2.</span> <span class="nav-text">RBAC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">10.3.</span> <span class="nav-text">使用示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Ingress"><span class="nav-number">11.</span> <span class="nav-text">K8S Ingress</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-%E4%BD%9C%E7%94%A8"><span class="nav-number">11.1.</span> <span class="nav-text">Ingress 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-Controller"><span class="nav-number">11.2.</span> <span class="nav-text">Ingress Controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress-%E4%BD%BF%E7%94%A8"><span class="nav-number">11.3.</span> <span class="nav-text">Ingress 使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-Helm-%E5%8C%85%E7%AE%A1%E7%90%86"><span class="nav-number">12.</span> <span class="nav-text">K8S Helm 包管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E4%BB%8B%E7%BB%8D"><span class="nav-number">12.1.</span> <span class="nav-text">Helm 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E4%BD%9C%E7%94%A8"><span class="nav-number">12.2.</span> <span class="nav-text">Helm 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">12.3.</span> <span class="nav-text">Helm 核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">12.4.</span> <span class="nav-text">Helm 客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E9%85%8D%E7%BD%AE-Chart-%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80"><span class="nav-number">12.5.</span> <span class="nav-text">Helm 配置 Chart 仓库地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">12.6.</span> <span class="nav-text">Helm 常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8"><span class="nav-number">12.7.</span> <span class="nav-text">Helm 快速部署应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E8%87%AA%E5%AE%9A%E4%B9%89-Chart-%E9%83%A8%E7%BD%B2"><span class="nav-number">12.8.</span> <span class="nav-text">Helm 自定义 Chart 部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-Chart-%E6%A8%A1%E7%89%88"><span class="nav-number">12.9.</span> <span class="nav-text">Helm Chart 模版</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="nav-number">13.</span> <span class="nav-text">K8S 持久化存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NFS"><span class="nav-number">13.1.</span> <span class="nav-text">NFS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PV%E3%80%81PVC"><span class="nav-number">13.2.</span> <span class="nav-text">PV、PVC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K8S-%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0"><span class="nav-number">14.</span> <span class="nav-text">K8S 监控平台</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="nav-number">14.1.</span> <span class="nav-text">监控指标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prometheus-Grafana"><span class="nav-number">14.2.</span> <span class="nav-text">Prometheus + Grafana</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">15.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Catnip"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Catnip</p>
  <div class="site-description" itemprop="description">度过大难, 将有大成, 继续努力, 终成大器.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">100</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
    <div class="feed-link motion-element" style="opacity: 1; display: block; transform: translateX(0px);">
        <a target="_blank"  href="/atom.xml" rel="alternate">
          <i class="fa fa-rss""></i>
          RSS
        </a>
    </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/catnip-5" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;catnip-5" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=1007331304&site=qq&menu=yes" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;1007331304&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  
  
  
	<script type="text/javascript" src="/js/cursor/fireworks.js"></script>
  

</body>
</html>
